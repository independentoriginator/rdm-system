<?xml version="1.1" encoding="UTF-8"?>
<databaseChangeLog 
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext 
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd 
        http://www.liquibase.org/xml/ns/dbchangelog 
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.1.xsd">
        
	<changeSet id="meta_index" author="${user}">

		<insert tableName="meta_type">
			<column name="internal_name" value="meta_index"/>
		</insert>

		<insert tableName="meta_attribute">
			<column name="meta_type_id" valueComputed="(select id from meta_type where internal_name = 'meta_index')"/>
			<column name="internal_name" value="internal_name"/>
			<column name="attr_type_id" valueComputed="(select id from meta_type where internal_name = 's')"/>
			<column name="length" value="63"/>
			<column name="is_non_nullable" value="true"/>
			<column name="is_unique" value="true"/>			
		</insert>

		<insert tableName="meta_type">
			<column name="internal_name" value="meta_index_attr"/>
			<column name="master_type_id" valueComputed="(select id from meta_type where internal_name = 'meta_index')"/>
		</insert>

		<insert tableName="meta_attribute">
			<column name="meta_type_id" valueComputed="(select id from meta_type where internal_name = 'meta_index_attr')"/>
			<column name="internal_name" value="meta_attr_id"/>
			<column name="attr_type_id" valueComputed="(select id from meta_type where internal_name = 'meta_attribute')"/>
			<column name="is_non_nullable" value="true"/>
		</insert>

		<insert tableName="meta_attribute">
			<column name="meta_type_id" valueComputed="(select id from meta_type where internal_name = 'meta_index_attr')"/>
			<column name="internal_name" value="ordinal_position"/>
			<column name="attr_type_id" valueComputed="(select id from meta_type where internal_name = 'n')"/>
			<column name="is_non_nullable" value="true"/>
		</insert>
		
	</changeSet>        

	<changeSet id="meta_index-uniqueness" author="${user}">
		<insert tableName="meta_attribute">
			<column name="meta_type_id" valueComputed="(select id from meta_type where internal_name = 'meta_index')"/>
			<column name="internal_name" value="is_unique"/>
			<column name="attr_type_id" valueComputed="(select id from meta_type where internal_name = 'b')"/>
			<column name="is_non_nullable" value="true"/>
			<column name="default_value" valueComputed="(select id from meta_expr where tag = 'bool.false')"/>
		</insert>
	</changeSet>      
	
</databaseChangeLog>
